{"componentChunkName":"component---src-views-docs-index-tsx","path":"/docs/master/components/api-gateway","webpackCompilationHash":"aefb7e842b40c338951f","result":{"pageContext":{"isCreatedByStatefulCreatePages":false,"version":"master","versions":{"releases":["0.9"],"prereleases":["1.0"],"branches":["master"]},"content":{"id":"api-gateway","displayName":"API Gateway","description":"Overall documentation for API Gateway","type":"components","docs":[{"order":"01-01-api-gateway","title":"Overview","source":"\nTo make your service accessible outside the Kyma cluster, expose it using the Kyma API Controller, which listens for the custom resource (CR) objects that follow the `api.gateway.kyma-project.io` CustomResourceDefinition (CRD). Creating a valid CR triggers the API Controller to create an Istio Virtual Service. Optionally, you can specify the **authentication** attribute of the CR to secure the exposed service and create an Istio Authentication Policy for it.\n"},{"order":"02-01-api-gateway","title":"Architecture","source":"\nThis diagram illustrates the workflow that leads to exposing a service in Kyma:\n\n![service-exposure-flow](./assets/001-service-exposure-flow.png)\n\n- **API Controller** is a component responsible for exposing services. The API Controller is an application deployed in the `kyma-system` Namespace, implemented according to the [Kubernetes Operator](https://coreos.com/blog/introducing-operators.html) principles. The API Controller listens for newly created custom resources (CR) that follow the set `api.gateway.kyma-project.io` CustomResourceDefinition (CRD), which describes the details of exposing services in Kyma.\n\n- **Istio Virtual Service** is used to specify the services that are visible outside the cluster. The API Controller creates a Virtual Service for the hostname defined in the `api.gateway.kyma-project.io` CRD. The convention is to create a hostname using the name of the service as the subdomain, and the domain of the Kyma cluster. To learn more about the Istio Virtual Service concept, read this [Istio documentation](https://kubernetes.io/docs/concepts/services-networking/ingress/).\nTo get the list of Virtual Services in Kyma, run:\n```\nkubectl get virtualservices.networking.istio.io --all-namespaces\n```\n\n- **Istio Authentication Policy** allows operators to specify authentication requirements for a service. It is an optional resource, created only when the CR specifies the desired authentication method, the token issuer, and the JSON Web Key Set (JWKS) endpoint URI. You can secure services using the `JWT` authentication method. You can specify multiple JWT issuers to allow to access the service with tokens from different ID providers. For more details, see [this](#details-security) document. The JWKS endpoint is used to fetch cryptographic keys, which allow to verify the ID token signature. Services exposed through a CR with the **authentication** section specified require valid ID tokens to access them. To learn more about the Istio Authentication Policy, read this [Istio security documentation](https://istio.io/docs/concepts/security/authn-policy/).\nTo get the list of Istio Authentication Policies created in Kyma, run:\n```\nkubectl get policies.authentication.istio.io --all-namespaces\n```\n"},{"order":"03-01-security","title":"Security","source":"\nWhen you expose a service in Kyma, you can secure it by specifying the **authentication** attribute in the custom resource (CR). To successfully secure the exposed service, its Pods must have the Istio sidecar injection enabled. Additionally, you must specify all of these attributes in the CR:\n  - **authentication.type**\n  - **jwt.issuer**\n  - **jwt.jwksUri**\n\nIf you don't specify any of these attributes, the API Controller doesn't create an Istio Authentication Policy for the service and leaves it unsecured.\n\n>**NOTE:** You can secure only the entire service. You cannot secure the specific endpoints of the service.\n\n## Call a secured service\n\nYou can secure the exposed service using JWT authentication. This means that you must include a valid JWT ID token in the `Authorization` header of the request when you call\na secured service.\n\nThis is an example of a call to a secure exposed service:\n```\ncurl -i https://httpbin.org/headers -H \"Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjFmNThlNTBhODI4OWMzYWM5MmE5ZTA2ZmM0YzIyZDc1NTU4MTc5YjIifQ.eyJpc3MiOiJodHRwczovL2RleC55ZmFjdG9yeS5zYXAuY29ycCIsInN1YiI6IkNpUXhPR0U0TmpnMFlpMWtZamc0TFRSaU56TXRPVEJoT1MwelkyUXhOall4WmpVME5qTVNCV3h2WTJGcyIsImF1ZCI6WyJreW1hLWNsaWVudCIsImt1YmVjb250cm9sbGVyIl0sImV4cCI6MTUzMDA5ODg3MiwiaWF0IjoxNTMwMDEyNDcyLCJhenAiOiJrdWJlY29udHJvbGxlciIsImF0X2hhc2giOiJ5QzJwY0ZmVWYzWVd2N2U5QUY3U0t3IiwiZW1haWwiOiJhZG1pbkBreW1hLmN4IiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJhZG1pbiJ9.pxy4P95PVSwIiXArcfsqAPVFhBmo5sHzUnqzwY6HF9UgMRkDFlIs5CKe1ZiGteGr6-gYU_0VmHroZ4alpcVcpL8Z5M2xnlOaZDyB8TNLvUAATpElcBMy6Cxb_7zLwP91IsX0QgI3DTg3H-M0eaJ4VwMKrfEu9h2rwxzvBrDc5vB_1Bm8OABl08wLSQpR27GGsI58RmA5YJmZX1PSzv90Zl_krqyvWIe6pmcHCrP--02LLUaoxhY42IDWkF8n9RPMLixmFZFXbeonCddR30OUkAbEFLBVBf8nJaFDms_VjZHSXZDitCu4r6myE4AnT_IeXI2dRgdGT73Hh8895zu7fQ\"\n```\n## Specify multiple JWT token issuers\n\nYou can specify multiple JWT token issuers to allow to access the secured service with tokens issued by different ID providers. You can successfully call the secured service using JWT ID tokens issued by any of the parties specified in the **authentication** attribute of the CR. This is an example of the **authentication** attribute that allows to access the service using JWT tokens signed by two different issuers.\n\n```\n    - type: JWT\n      jwt:\n        issuer: https://sampleissuer1.abc.com\n        jwksUri: https://www.sampleapis.com/oauth2/v3/certs\n    - type: JWT\n      jwt:\n        issuer: https://sampleissuer2.abc.com\n        jwksUri: https://www.regularsampleapis.com/oauth2/v3/certs\n```\n","type":"Details"},{"order":"06-01-api","title":"Api","source":"\nThe `api.gateway.kyma-project.io` CustomResourceDefinition (CRD) is a detailed description of the kind of data and the format the API Controller listens for. To get the up-to-date CRD and show\nthe output in the `yaml` format, run this command:\n```\nkubectl get crd apis.gateway.kyma-project.io -o yaml\n```\n\n## Sample custom resource\n\nThis is a sample custom resource (CR) that the API-Controller listens for to expose a service. This example has the **authentication** section specified which makes the API Controller create an Istio Authentication Policy for this service.\n\n```\napiVersion: gateway.kyma-project.io/v1alpha2\nkind: Api\nmetadata:\n    name: sample-api\nspec:\n    service:\n      name: kubernetes\n      port: 443\n    hostname: kubernetes.kyma.local\n    authentication:\n    - type: JWT\n      jwt:\n        issuer: https://accounts.google.com\n        jwksUri: https://www.googleapis.com/oauth2/v3/certs\n```\n\nThis table lists all the possible parameters of a given resource together with their descriptions:\n\n| Field   |      Mandatory      |  Description |\n|----------|:-------------:|------|\n| **metadata.name** |    **YES**   | Specifies the name of the exposed API |\n| **service.name**, **service.port** | **YES** | Specifies the name and the communication port of the exposed service. |\n| **spec.hostname** | **YES** | Specifies the service's external inbound communication address. |\n| **spec.authentication** | **NO** | Allows to specify an array of authentication policies that secure the service. |\n| **authentication.type** | **YES** | Specifies the desired authentication method that secures the exposed service. |\n| **authentication.jwt.issuer**, **authentication.jwt.jwksUri** | **YES** | Specifies the issuer of the tokens used to access the services, as well as the JWKS endpoint URI. |\n\n\n## Additional information\n\nWhen you fetch an existing Api CR, the system adds the **status** section which describes the status of the Virtual Service and the Authentication Policy created for this CR. This table lists the fields of the **status** section.\n\n| Field   |  Description |\n|----------|-------------|\n| **status.validationStatus** | Status code describing the Api CR. |\n| **status.virtualService.code** | Status code describing the Virtual Service. |\n| **status.virtualService.lastError** | Last error reported when creating or updating the Virtual Service. |\n| **status.virtualService.resource.name** | Name of the created Virtual Service. |\n| **status.virtualService.resource.uid** | UID of the created Virtual Service. |\n| **status.virtualService.resource.version** | Version of the created Virtual Service. |\n| **status.authenticationStatus.code** | Status code describing the Authentication Policy. |\n| **status.authenticationStatus.lastError** | Last error reported when creating or updating the Authentication Policy. |\n| **status.authenticationStatus.resource.name** | Name of the created Authentication Policy. |\n| **status.authenticationStatus.resource.uid** | UID of the created Authentication Policy. |\n| **status.authenticationStatus.resource.version** | Version of the created Authentication Policy. |\n\n>**NOTE:** The **authenticationStatus** section is optional. It is created only when authentication is enabled for the given API.\n\n\n### Status codes\n\nThese are the status codes used to describe the Authentication Policies and Virtual Services:\n\n| Code   |  Description |\n|----------|-------------|\n| **0** | Resource not created. |\n| **1** | Resource creation in progress. |\n| **2** | Resource created successfully. |\n| **3** | Error - resource not created. |\n| **4** | Virtual Service-specific. Hostname already in use by a different Virtual Service. |\n| **5** | Api CR-specific. Another Api CR exists for the target Service. |\n","type":"Custom Resource"}]},"navigation":{"root":[{"displayName":"Kyma","id":"kyma"}],"components":[{"displayName":"Security","id":"security"},{"displayName":"Service Catalog","id":"service-catalog"},{"displayName":"Helm Broker","id":"helm-broker"},{"displayName":"Application Connector","id":"application-connector"},{"displayName":"Event Bus","id":"event-bus"},{"displayName":"Service Mesh","id":"service-mesh"},{"displayName":"Serverless","id":"serverless"},{"displayName":"Monitoring","id":"monitoring"},{"displayName":"Tracing","id":"tracing"},{"displayName":"API Gateway","id":"api-gateway"},{"displayName":"Logging","id":"logging"},{"displayName":"Backup","id":"backup"},{"displayName":"Console","id":"console"},{"displayName":"Asset Store","id":"asset-store"},{"displayName":"Headless CMS","id":"headless-cms"}]},"manifest":{"root":[{"displayName":"Kyma","id":"kyma"}],"components":[{"displayName":"Security","id":"security"},{"displayName":"Service Catalog","id":"service-catalog"},{"displayName":"Helm Broker","id":"helm-broker"},{"displayName":"Application Connector","id":"application-connector"},{"displayName":"Event Bus","id":"event-bus"},{"displayName":"Service Mesh","id":"service-mesh"},{"displayName":"Serverless","id":"serverless"},{"displayName":"Monitoring","id":"monitoring"},{"displayName":"Tracing","id":"tracing"},{"displayName":"API Gateway","id":"api-gateway"},{"displayName":"Logging","id":"logging"},{"displayName":"Backup","id":"backup"},{"displayName":"Console","id":"console"},{"displayName":"Asset Store","id":"asset-store"},{"displayName":"Headless CMS","id":"headless-cms"}]},"assetsPath":"/assets/docs/master/api-gateway/docs/assets/","docsType":"components","topic":"api-gateway","slidesBanner":{"bannerDuration":5000,"slides":[{"text":"Don't miss the session by Piotr Kopczynski at Helm Summit on September 11 at 15:47.","url":"https://helmsummit2019.sched.com/event/S8sS","startDate":"09/09/2019","endDate":"12/09/2019"}]},"locale":"en"}}}