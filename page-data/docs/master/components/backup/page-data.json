{"componentChunkName":"component---src-views-docs-index-tsx","path":"/docs/master/components/backup","webpackCompilationHash":"aefb7e842b40c338951f","result":{"pageContext":{"isCreatedByStatefulCreatePages":false,"version":"master","versions":{"releases":["0.9"],"prereleases":["1.0"],"branches":["master"]},"content":{"id":"backup","displayName":"Backup","description":"Overall documentation for Backup","type":"components","docs":[{"order":"01-01-backup","title":"Overview","source":"\nThe backup in Kyma uses [Ark](https://github.com/heptio/velero/).\n\n>**NOTE:** The Ark project changed its name to Velero. The full migration is planned once the new Velero version is available.\n\nArk backs up Kubernetes resources and stores them in Azure Blob storage. It triggers physical volume snapshots and includes the snapshot references in the backup. Ark can create scheduled or on-demand backups, filter objects to include in the backup, and set time to live (TTL) for stored backups.\n\nFor more details, see the official [Ark documentation](https://heptio.github.io/velero/v0.9.0/)."},{"order":"03-01-backup-configuration","title":"Configuration","source":"\nThe Ark configuration consists of two custom resources:\n\n- [VolumeSnapshotLocation](https://github.com/heptio/velero/blob/master/docs/api-types/volumesnapshotlocation.md) CR defines the provider of physical volume snapshots.\n- [BackupStorageLocation](https://github.com/heptio/velero/blob/master/docs/api-types/backupstoragelocation.md) CR defines a bucket or storage location for cluster resources.\n\nA sample BackupStorageLocation CR looks like this:\n\n```apiVersion: ark.heptio.com/v1\nkind: BackupStorageLocation\nmetadata:\n  name: default\n  namespace: heptio-ark\nspec:\n  config:\n    resourceGroup: BackupStorage\n    storageAccount: foo...\n  objectStorage:\n    bucket: bucket\n  provider: azure\n```\n\nA sample VolumeSnapshotLocation CR looks like this:\n\n```apiVersion: ark.heptio.com/v1\nkind: VolumeSnapshotLocation\nmetadata:\n  name: azure-default\n  namespace: heptio-ark\nspec:\n  config:\n    apiTimeout: 15m\n  provider: azure\n```\n\nA Kyma installation provides a set of default snapshot and storage locations. If needed, you can add custom locations in the `heptio-ark` Namespace.","type":"Details"},{"order":"03-02-create-backup","title":"Back up a Kyma cluster","source":"Kyma provides two validated sample backup specification files:\n\n- [System Namespace Backup](./assets/system-backup.yaml)\n- [User Namespace Backup](./assets/all-backup.yaml)\n\n\nIntegrate these files with your scheduled or on-demand configurations to back up system or user Namespaces. \n\n>**NOTE:** To fully back up a cluster, you must back up both user and system Namespaces. \n\nModify the files to adjust the backup scope. For details about the file format, see the [Ark documentation](https://github.com/heptio/velero/blob/master/docs/api-types/backup.md).\n\n## Create manual backups\n\nIf you want to use sample backup configurations, you must use Backup custom resources instead of Ark CLI. Add the following two CRs to the `heptio-ark` Namespace to instruct the Ark server to create a backup. Make sure the indentation is correct.\n\nA sample backup configuration looks like this:\n\n```yaml\n---\napiVersion: ark.heptio.com/v1\nkind: Backup\nmetadata:\n  name: kyma-system-backup\n  namespace: heptio-ark\nspec:\n    <INCLUDE CONTENT OF SYSTEM NAMESPACE BACKUP FILE HERE>\n---\napiVersion: ark.heptio.com/v1\nkind: Backup\nmetadata:\n  name: kyma-backup\n  namespace: heptio-ark\nspec:\n    <INCLUDE CONTENT OF USER NAMESPACE BACKUP FILE HERE>\n```\n\nTo create the backup, run the following command:\n\n```$ kubectl apply -f <filename>```\n\n## Schedule periodic backups\n\nIf you want to use sample backup configurations, ou must use Schedule custom resources instead of Ark CLI. Create two Schedule custom resources in the `heptio-ark` Namespace to instruct the Ark Server to schedule a cluster backup. Make sure the indentation is correct.\n\nA sample scheduled backup configuration looks like this:\n\n```yaml\n---\napiVersion: ark.heptio.com/v1\nkind: Schedule\nmetadata:\n  name: kyma-system-backup\n  namespace: heptio-ark\nspec:\n    template:\n        <INCLUDE CONTENT OF SYSTEM NAMESPACE BACKUP SPEC HERE>\n    schedule: 0 1 * * *\n---\napiVersion: ark.heptio.com/v1\nkind: Schedule\nmetadata:\n  name: kyma-backup\n  namespace: heptio-ark\nspec:\n    template:\n        <INCLUDE CONTENT OF SYSTEM NAMESPACE BACKUP SPEC HERE>\n    schedule: 0 1 * * *\n```\n\nTo schedule a backup, run the following command:\n\n```$ kubectl apply -f <filename>```\n\n## Backup retention period\n\nTo set the retention period of a backup, define the **ttl** parameter in the Backup specification [definition](https://github.com/heptio/velero/blob/master/docs/api-types/backup.md#definition):\n\n```  The amount of time before this backup is eligible for garbage collection.\n  ttl: 24h0m0s \n  ```\n","type":"Details"},{"order":"03-03-restore-backup","title":"Restore a Kyma cluster","source":"\nRestoring a Kyma cluster requires a fresh Kyma installation. As soon as the cluster is up and running, instruct Ark to start the restore process. Make sure to restore the system and user Namespaces at the same time so both are in sync.\n\nUse this command to list available backups:\n\n```$ kubectl get backups -n heptio-ark```\n\nSample restore configuration:\n\n```yaml\n---\napiVersion: ark.heptio.com/v1\nkind: Restore\nmetadata:\n  name: kyma-restore\n  namespace: heptio-ark\nspec:\n    backupName: null # specify to restore a specific backup\n    scheduleName: kyma-backup # Applies only if no backup is specified.\n    restorePVs: true\n    includeClusterResources: true\n---\napiVersion: ark.heptio.com/v1\nkind: Restore\nmetadata:\n  name: kyma-system-restore\n  namespace: heptio-ark\nspec:\n    backupName: null # specify to restore a specific backup\n    scheduleName: kyma-system-backup # Applies only if no backup is specified.\n    restorePVs: true\n    includeClusterResources: true\n```\n\nTo trigger the restore process, run this command:\n\n```$ kubectl apply -f <filename>```\n\nTo check the restore progress, run this command:\n\n```$ kubectl describe restore -n heptio-ark  <restore name>```\n\nTo validate the result of the restore use the `kubectl get` command.\n\n> **NOTE:** Even if the restore process is complete, it may take some time for the resources to become available again.","type":"Details"}]},"navigation":{"root":[{"displayName":"Kyma","id":"kyma"}],"components":[{"displayName":"Security","id":"security"},{"displayName":"Service Catalog","id":"service-catalog"},{"displayName":"Helm Broker","id":"helm-broker"},{"displayName":"Application Connector","id":"application-connector"},{"displayName":"Event Bus","id":"event-bus"},{"displayName":"Service Mesh","id":"service-mesh"},{"displayName":"Serverless","id":"serverless"},{"displayName":"Monitoring","id":"monitoring"},{"displayName":"Tracing","id":"tracing"},{"displayName":"API Gateway","id":"api-gateway"},{"displayName":"Logging","id":"logging"},{"displayName":"Backup","id":"backup"},{"displayName":"Console","id":"console"},{"displayName":"Asset Store","id":"asset-store"},{"displayName":"Headless CMS","id":"headless-cms"}]},"manifest":{"root":[{"displayName":"Kyma","id":"kyma"}],"components":[{"displayName":"Security","id":"security"},{"displayName":"Service Catalog","id":"service-catalog"},{"displayName":"Helm Broker","id":"helm-broker"},{"displayName":"Application Connector","id":"application-connector"},{"displayName":"Event Bus","id":"event-bus"},{"displayName":"Service Mesh","id":"service-mesh"},{"displayName":"Serverless","id":"serverless"},{"displayName":"Monitoring","id":"monitoring"},{"displayName":"Tracing","id":"tracing"},{"displayName":"API Gateway","id":"api-gateway"},{"displayName":"Logging","id":"logging"},{"displayName":"Backup","id":"backup"},{"displayName":"Console","id":"console"},{"displayName":"Asset Store","id":"asset-store"},{"displayName":"Headless CMS","id":"headless-cms"}]},"assetsPath":"/assets/docs/master/backup/docs/assets/","docsType":"components","topic":"backup","slidesBanner":{"bannerDuration":5000,"slides":[{"text":"Don't miss the session by Piotr Kopczynski at Helm Summit on September 11 at 15:47.","url":"https://helmsummit2019.sched.com/event/S8sS","startDate":"09/09/2019","endDate":"12/09/2019"}]},"locale":"en"}}}